"use strict";(self["webpackChunkweb_admin"]=self["webpackChunkweb_admin"]||[]).push([[542],{7617:(t,e,n)=>{n.d(e,{A:()=>v});var a=n(35280),i=function(t){return(0,a.Qi)("data-v-5493a6d5"),t=t(),(0,a.jt)(),t},r={class:"map-container"},l={key:0,class:"map-label"},o={class:"map-view"},u=i((function(){return(0,a.Lk)("div",{id:"SelectMapPoint"},null,-1)})),d={key:0,class:"baiduMap-address"};function s(t,e,n,i,s,c){var p=(0,a.g2)("a-button");return(0,a.uX)(),(0,a.CE)("div",r,[n.label?((0,a.uX)(),(0,a.CE)("div",l,(0,a.v_)(n.label),1)):(0,a.Q3)("",!0),(0,a.Lk)("div",o,[u,n.immediately?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("span",null,"定位地址："+(0,a.v_)(s.address),1),(0,a.Lk)("div",null,[s.address?((0,a.uX)(),(0,a.Wv)(p,{key:0,onClick:c.onOk},{default:(0,a.k6)((function(){return[(0,a.eW)("确定")]})),_:1},8,["onClick"])):(0,a.Q3)("",!0)])]))])])}n(62062);var c=n(76136),p=n(25818);const f={name:"Map",data:function(){return{map:null,geoc:new BMap.Geocoder,province:"",city:"",district:"",address:"",lat:"",lng:""}},props:{point:{type:Object,default:new Object},label:String,immediately:{default:!1}},methods:{renderMap:function(){var t=this,e=p.qN.MAP_CENTER,n=new BMap.Map("SelectMapPoint",{enableMapClick:!1}),a=this.point.lat||e.lat,i=this.point.lng||e.lng,r=new BMap.Point(i,a);n.centerAndZoom(r,15),n.enableScrollWheelZoom(),n.addEventListener("click",(function(e){t.clickMap(e)})),this.map=n},clickMap:function(t){var e=this;console.log(t);var n=this.map,a=t.point,i=a.lng,r=a.lat;n.clearOverlays();var l=new BMap.Point(i,r),o=new BMap.Marker(l);o.id="centerMarker",n.addOverlay(o),this.geoc.getLocation(l,(function(t){var n=t.addressComponents;e.province=n.province||"",e.city=n.city||"",e.district=n.district||"",e.address=(n.street||"")+(n.streetNumber||""),e.lat=r,e.lng=i,e.immediately&&e.onOk()}))},onOk:function(){var t={province:this.province,city:this.city,district:this.district,address:this.address,lng:this.lng,lat:this.lat};this.$emit("update:result",t)},renderUpdateMarker:function(){if(!c.A.isEmpty(this.point)){this.map.clearOverlays(),this.lng=this.point.lng,this.lat=this.point.lat,this.address=this.point.address;var t=new BMap.Point(this.lng,this.lat),e=new BMap.Marker(t);e.id="centerMarker",this.map.addOverlay(e),this.map.setCenter(t)}}},mounted:function(){this.renderMap()},watch:{point:function(t){t.lat&&t.lng&&this.renderUpdateMarker()}}};var h=n(71241);const k=(0,h.A)(f,[["render",s],["__scopeId","data-v-5493a6d5"]]),v=k},64542:(t,e,n)=>{n.r(e),n.d(e,{default:()=>A});n(28706),n(62010);var a=n(35280),i=["id"],r=(0,a.Lk)("i",{class:"ri-add-line"},null,-1),l=(0,a.Lk)("span",null,"添加部门",-1),o={key:0,class:"icon-cell"},u=["onClick"],d=["onClick"],s={class:"add-form-page"};function c(t,e,n,c,p,f){var h=(0,a.g2)("a-button"),k=(0,a.g2)("a-space"),v=(0,a.g2)("a-row"),y=(0,a.g2)("a-tree"),m=(0,a.g2)("a-card"),b=(0,a.g2)("a-col"),g=(0,a.g2)("a-input"),E=(0,a.g2)("a-form-item"),A=(0,a.g2)("a-form"),w=(0,a.g2)("a-divider"),C=(0,a.g2)("a-table"),_=(0,a.g2)("a-tree-select"),F=(0,a.g2)("a-input-number"),M=(0,a.g2)("selectMapPoint"),x=(0,a.g2)("a-modal");return(0,a.uX)(),(0,a.CE)("div",{id:t.$route.name},[(0,a.bF)(m,null,{title:(0,a.k6)((function(){return[(0,a.bF)(v,{justify:"space-between",align:"top"},{default:(0,a.k6)((function(){return[(0,a.bF)(k,null,{default:(0,a.k6)((function(){return[(0,a.bF)(h,{type:"primary",onClick:e[0]||(e[0]=(0,a.D$)((function(t){return f.onItemEditClick()}),["prevent"]))},{default:(0,a.k6)((function(){return[r,l]})),_:1})]})),_:1})]})),_:1})]})),default:(0,a.k6)((function(){return[(0,a.bF)(v,{type:"flex",gutter:16},{default:(0,a.k6)((function(){return[(0,a.bF)(b,{flex:"0 0 256px",style:{overflow:"hidden"}},{default:(0,a.k6)((function(){return[(0,a.bF)(m,null,{default:(0,a.k6)((function(){return[p.treeList.length>0?((0,a.uX)(),(0,a.Wv)(y,{key:0,defaultExpandAll:!0,checkStrictly:!0,"tree-data":p.treeList,"show-line":"",onSelect:f.onTreeSelectClick,fieldNames:{key:"id",title:"name",value:"id"}},null,8,["tree-data","onSelect"])):(0,a.Q3)("",!0)]})),_:1})]})),_:1}),(0,a.bF)(b,{flex:"1",style:{overflow:"hidden"}},{default:(0,a.k6)((function(){return[(0,a.bF)(A,{class:"page-form",layout:"inline"},{default:(0,a.k6)((function(){return[(0,a.bF)(E,null,{default:(0,a.k6)((function(){return[(0,a.bF)(g,{style:{width:"320px"},placeholder:"名称/联系人/联系电话/地址",value:p.searchText,"onUpdate:value":e[1]||(e[1]=function(t){return p.searchText=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,null,{default:(0,a.k6)((function(){return[(0,a.bF)(h,{type:"primary",onClick:(0,a.D$)(f.onSearchClick,["prevent"])},{default:(0,a.k6)((function(){return[(0,a.eW)("查询")]})),_:1},8,["onClick"]),(0,a.bF)(h,{type:"link",onClick:(0,a.D$)(f.onResetClick,["prevent"])},{default:(0,a.k6)((function(){return[(0,a.eW)("重置")]})),_:1},8,["onClick"])]})),_:1})]})),_:1}),(0,a.bF)(C,{columns:p.defaultColumns,onChange:f.handleTableChange,"data-source":p.pagination.data,pagination:p.pagination,rowKey:function(t){return t.id},scroll:{x:1e3},bordered:""},{bodyCell:(0,a.k6)((function(t){var e=t.column,n=t.record;return["icon"==e.key?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("i",{class:(0,a.C4)(n.icon)},null,2),(0,a.eW)("  "+(0,a.v_)(n.icon),1)])):(0,a.Q3)("",!0),"action"==e.key?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(t){return f.onItemEditClick(n)}),["prevent"])},"编辑",8,u),(0,a.bF)(w,{type:"vertical"}),(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(t){return f.onItemDeleteClick(n)}),["prevent"])},"删除",8,d)],64)):(0,a.Q3)("",!0)]})),_:1},8,["columns","onChange","data-source","pagination","rowKey"])]})),_:1})]})),_:1})]})),_:1}),(0,a.bF)(x,{visible:p.showAddModal,"onUpdate:visible":e[9]||(e[9]=function(t){return p.showAddModal=t}),destroyOnClose:"",title:"部门信息",onCancel:e[10]||(e[10]=function(t){return p.editEntity={}}),onOk:f.onSubmitEditEntityClick,width:1e3},{default:(0,a.k6)((function(){return[(0,a.Lk)("div",s,[(0,a.bF)(A,{labelCol:{flex:" 0 0 6em"},wrapperCol:{flex:"1"},labelAlign:"left"},{default:(0,a.k6)((function(){return[(0,a.bF)(v,{gutter:24},{default:(0,a.k6)((function(){return[(0,a.bF)(b,{span:12},{default:(0,a.k6)((function(){return[(0,a.bF)(E,{label:"部门名称",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",value:p.editEntity.name,"onUpdate:value":e[2]||(e[2]=function(t){return p.editEntity.name=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"联系人",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",value:p.editEntity.linkName,"onUpdate:value":e[3]||(e[3]=function(t){return p.editEntity.linkName=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"联系电话",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",value:p.editEntity.linkPhone,"onUpdate:value":e[4]||(e[4]=function(t){return p.editEntity.linkPhone=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"上级部门",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(_,{placeholder:"请输入",value:p.editEntity.parentId,"onUpdate:value":e[5]||(e[5]=function(t){return p.editEntity.parentId=t}),"tree-data":p.treeList,fieldNames:{key:"id",label:"name",value:"id"}},null,8,["value","tree-data"])]})),_:1}),(0,a.bF)(E,{label:"省市区"},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",disabled:!0,value:"".concat(p.editEntity.province?p.editEntity.province+",":"").concat(p.editEntity.city?p.editEntity.city+",":"").concat(p.editEntity.county?p.editEntity.county+",":"")},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"详细地址"},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",value:p.editEntity.address,"onUpdate:value":e[6]||(e[6]=function(t){return p.editEntity.address=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"排序",help:"数字越小，排名越靠前",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(F,{value:p.editEntity.sortno,"onUpdate:value":e[7]||(e[7]=function(t){return p.editEntity.sortno=t})},null,8,["value"])]})),_:1}),(0,a.bF)(E,{label:"备注"},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请输入",value:p.editEntity.note,"onUpdate:value":e[8]||(e[8]=function(t){return p.editEntity.note=t})},null,8,["value"])]})),_:1})]})),_:1}),(0,a.bF)(b,{span:12},{default:(0,a.k6)((function(){return[(0,a.bF)(M,{point:{lat:p.editEntity.lat,lng:p.editEntity.lng},immediately:!0,"onUpdate:result":f.onPointCallback},null,8,["point","onUpdate:result"])]})),_:1})]})),_:1})]})),_:1})])]})),_:1},8,["visible","onOk"])],8,i)}var p=n(41034),f=n(14048),h=n(30388),k=(n(58940),n(27495),n(90906),n(42762),n(83496)),v=n(25818),y=n(76136),m=n(7617);const b={components:{selectMapPoint:m.A},data:function(){var t=this;return{sortField:"",sortOrder:"",editEntity:{},showAddModal:!1,treeList:[],searchText:"",parentId:"",defaultColumns:[{title:"部门名称",dataIndex:"name"},{title:"联系人",dataIndex:"linkName"},{title:"联系电话",dataIndex:"linkPhone"},{title:"上级部门",dataIndex:"parentName"},{title:"省",dataIndex:"province"},{title:"市",dataIndex:"city"},{title:"区",dataIndex:"county"},{title:"详细地址",dataIndex:"address",width:200},{title:"排序",dataIndex:"sortno",align:"center"},{title:"备注",dataIndex:"note"},{title:"操作",key:"action",width:140}],pagination:{current:1,pageSize:parseInt(v.qN.PAGE_SIZE_OPTIONS[0]),showQuickJumper:!0,showSizeChanger:!0,data:[],total:0,pageSizeOptions:v.qN.PAGE_SIZE_OPTIONS,showTotal:function(){return"共 ".concat(t.pagination.total," 条")}}}},mounted:function(){var t=this;return(0,h.A)((0,f.A)().mark((function e(){return(0,f.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.onSearchClick();case 1:case"end":return e.stop()}}),e)})))()},methods:{onPointCallback:function(t){var e=this.editEntity;e.province=t.province,e.city=t.city,e.county=t.district,e.address=t.address,e.lat=t.lat,e.lng=t.lng,this.showMapModal=!1},onTreeSelectClick:function(t){this.parentId=t[0]||"",this.onSearchClick()},handleTableChange:function(t,e,n){this.pagination.current=t.current,this.pagination.pageSize=t.pageSize,this.sortField=n.field,this.sortOrder=n.order,this.requestData(!0)},onSubmitEditEntityClick:function(){var t=this;return(0,h.A)((0,f.A)().mark((function e(){var n,a;return(0,f.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.editEntity,!y.A.isEmpty(n.name)){e.next=4;break}return k.A.showToast("请输入部门名称"),e.abrupt("return");case 4:if(n.name=(n.name+"").trim(),!y.A.isEmpty(n.linkName)){e.next=8;break}return k.A.showToast("请输入联系人"),e.abrupt("return");case 8:if(n.linkName=(n.linkName+"").trim(),!y.A.isEmpty(n.linkPhone)){e.next=12;break}return k.A.showToast("请输入联系电话"),e.abrupt("return");case 12:if(n.linkPhone=(n.linkPhone+"").trim(),!y.A.isEmpty(n.name)){e.next=16;break}return k.A.showToast("请输入部门名称"),e.abrupt("return");case 16:if(n.name=(n.name+"").trim(),/^\d+$/.test(n.sortno)){e.next=20;break}return k.A.showToast("请输入排序序号"),e.abrupt("return");case 20:if(!k.A.utils.isEmpty(n.parentId)){e.next=23;break}return k.A.showToast("请选择上级部门"),e.abrupt("return");case 23:if(n.parentId!=n.id){e.next=26;break}return k.A.showToast("上级部门不能选择".concat(n.name)),e.abrupt("return");case 26:return k.A.showLoading(),e.next=29,k.A.postAsync(v.tl.ADMIN_DEPARTMENT_SAVE,n);case 29:a=e.sent,k.A.hideLoading(),0==a.status&&(k.A.showToast(a.message),t.showAddModal=!1,t.editEntity={},t.onSearchClick());case 32:case"end":return e.stop()}}),e)})))()},onItemEditClick:function(t){this.showAddModal=!0,this.editEntity=(0,p.A)({},t)},onItemDeleteClick:function(t){var e=this;this.$confirm({title:"提示",content:"确定要删除该部门吗？",onOk:function(){var n=(0,h.A)((0,f.A)().mark((function n(){var a;return(0,f.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return k.A.showLoading(),n.next=3,k.A.postAsync(v.tl.ADMIN_DEPARTMENT_DEL,{deptId:t.id});case 3:a=n.sent,k.A.hideLoading(),0==a.status&&(k.A.showToast(a.message),e.onSearchClick());case 6:case"end":return n.stop()}}),n)})));function a(){return n.apply(this,arguments)}return a}()})},onSearchClick:function(){var t=this.pagination;t.current=1,this.requestData(!0)},onResetClick:function(){this.searchText="",this.onSearchClick()},requestData:function(){var t=arguments,e=this;return(0,h.A)((0,f.A)().mark((function n(){var a,i,r,l,o,u,d,s,c,p;return(0,f.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.length>0&&void 0!==t[0]&&t[0],i=e.searchText,r=e.parentId,l=void 0===r?"":r,o=e.sortField,u=e.sortOrder,d=e.pagination,a&&k.A.showLoading(),s={page:d.current,limit:d.pageSize,parentId:l},y.A.isEmpty(i)||(s.keyword=i),y.A.isEmpty(o)||(s.orderField=o,s.orderType="ascend"==u?"asc":"descend"==u?"desc":""),n.next=9,k.A.postAsync(v.tl.ADMIN_DEPARTMENT_LIST,s);case 9:return c=n.sent,0==c.status&&(p=c.data,d.current=p.page,d.total=p.count,d.data=p.data,e.pagination=d),n.next=13,k.A.postAsync(v.tl.USER_DEPARTMENT_TREE_LIST,{showRoot:"y",userId:k.A.userInfo.get().userId});case 13:c=n.sent,0==c.status&&(e.treeList=c.data),a&&k.A.hideLoading();case 16:case"end":return n.stop()}}),n)})))()}}};var g=n(71241);const E=(0,g.A)(b,[["render",c]]),A=E}}]);