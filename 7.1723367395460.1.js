"use strict";(self["webpackChunkweb_admin"]=self["webpackChunkweb_admin"]||[]).push([[7],{92007:(e,n,t)=>{t.r(n),t.d(n,{default:()=>S});t(62010);var i=t(35280),r=["id"],a=(0,i.Lk)("i",{class:"ri-add-line"},null,-1),o=(0,i.Lk)("span",null,"添加角色",-1),u=["onClick"],l=["onClick"],c=["onClick"],s=["onClick"];function d(e,n,t,d,f,h){var p=(0,i.g2)("a-input"),k=(0,i.g2)("a-form-item"),m=(0,i.g2)("a-button"),v=(0,i.g2)("a-form"),E=(0,i.g2)("a-space"),y=(0,i.g2)("a-row"),A=(0,i.g2)("a-divider"),C=(0,i.g2)("a-table"),b=(0,i.g2)("a-card"),g=(0,i.g2)("a-radio-button"),w=(0,i.g2)("a-radio-group"),_=(0,i.g2)("a-textarea"),L=(0,i.g2)("a-modal"),F=(0,i.g2)("a-tree"),S=(0,i.g2)("a-col");return(0,i.uX)(),(0,i.CE)("div",{id:e.$route.name},[(0,i.bF)(b,null,{title:(0,i.k6)((function(){return[(0,i.bF)(y,{justify:"space-between",align:"top"},{default:(0,i.k6)((function(){return[(0,i.bF)(v,{layout:"inline"},{default:(0,i.k6)((function(){return[(0,i.bF)(k,null,{default:(0,i.k6)((function(){return[(0,i.bF)(p,{placeholder:"角色名称",value:f.nameLike,"onUpdate:value":n[0]||(n[0]=function(e){return f.nameLike=e}),style:{width:"180px"},allowClear:""},null,8,["value"])]})),_:1}),(0,i.bF)(k,null,{default:(0,i.k6)((function(){return[(0,i.bF)(m,{type:"primary",onClick:(0,i.D$)(h.onSearchClick,["prevent"])},{default:(0,i.k6)((function(){return[(0,i.eW)("查询")]})),_:1},8,["onClick"]),(0,i.bF)(m,{type:"link",onClick:(0,i.D$)(h.onResetClick,["prevent"])},{default:(0,i.k6)((function(){return[(0,i.eW)("重置")]})),_:1},8,["onClick"])]})),_:1})]})),_:1}),(0,i.bF)(E,null,{default:(0,i.k6)((function(){return[(0,i.bF)(m,{type:"primary",onClick:n[1]||(n[1]=(0,i.D$)((function(e){return h.onItemEditClick()}),["prevent"]))},{default:(0,i.k6)((function(){return[a,o]})),_:1})]})),_:1})]})),_:1})]})),default:(0,i.k6)((function(){return[(0,i.bF)(C,{columns:f.defaultColumns,onChange:h.handleTableChange,"data-source":f.pagination.data,pagination:f.pagination,rowKey:function(e){return e.id},scroll:{x:1e3},bordered:""},{bodyCell:(0,i.k6)((function(e){var n=e.column,t=e.record;return["action"==n.key?((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[(0,i.Lk)("a",{href:"javascript:;",onClick:(0,i.D$)((function(e){return h.onItemEditClick(t)}),["prevent"])},"编辑",8,u),(0,i.bF)(A,{type:"vertical"}),(0,i.Lk)("a",{href:"javascript:;",onClick:(0,i.D$)((function(e){return h.onItemEditPermissionsClick(t)}),["prevent"])},"分配菜单",8,l),(0,i.bF)(A,{type:"vertical"}),(0,i.Lk)("a",{href:"javascript:;",onClick:(0,i.D$)((function(e){return h.onItemClearPermissionsClick(t)}),["prevent"])},"清空菜单",8,c),(0,i.bF)(A,{type:"vertical"}),(0,i.Lk)("a",{href:"javascript:;",onClick:(0,i.D$)((function(e){return h.onItemDeleteClick(t)}),["prevent"])},"删除",8,s)],64)):(0,i.Q3)("",!0)]})),_:1},8,["columns","onChange","data-source","pagination","rowKey"])]})),_:1}),(0,i.bF)(L,{visible:f.showAddRoleModal,"onUpdate:visible":n[6]||(n[6]=function(e){return f.showAddRoleModal=e}),title:"角色信息",width:"600px",centered:"",onCancel:n[7]||(n[7]=function(e){return f.editEntity={}}),onOk:h.onSubmitEditEntityClick},{default:(0,i.k6)((function(){return[(0,i.bF)(v,{labelCol:{span:7},wrapperCol:{span:13}},{default:(0,i.k6)((function(){return[(0,i.bF)(k,{label:"角色级别",required:""},{default:(0,i.k6)((function(){return[(0,i.bF)(w,{value:f.editEntity.level,"onUpdate:value":n[2]||(n[2]=function(e){return f.editEntity.level=e})},{default:(0,i.k6)((function(){return[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.levelList,(function(e){return(0,i.uX)(),(0,i.Wv)(g,{key:e.value,value:e.value},{default:(0,i.k6)((function(){return[(0,i.eW)((0,i.v_)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1}),(0,i.bF)(k,{label:"角色编码",required:""},{default:(0,i.k6)((function(){return[(0,i.bF)(p,{placeholder:"请输入",value:f.editEntity.id,"onUpdate:value":n[3]||(n[3]=function(e){return f.editEntity.id=e})},null,8,["value"])]})),_:1}),(0,i.bF)(k,{label:"角色名称",required:""},{default:(0,i.k6)((function(){return[(0,i.bF)(p,{placeholder:"请输入",value:f.editEntity.name,"onUpdate:value":n[4]||(n[4]=function(e){return f.editEntity.name=e})},null,8,["value"])]})),_:1}),(0,i.bF)(k,{label:"备注"},{default:(0,i.k6)((function(){return[(0,i.bF)(_,{placeholder:"请输入",rows:4,"allow-clear":"",value:f.editEntity.note,"onUpdate:value":n[5]||(n[5]=function(e){return f.editEntity.note=e})},null,8,["value"])]})),_:1})]})),_:1})]})),_:1},8,["visible","onOk"]),(0,i.bF)(L,{visible:!!f.permissionEntity.id,title:"菜单分配",centered:"",onCancel:n[10]||(n[10]=function(e){return f.permissionEntity={}}),onOk:h.onSubmitPermissionClick},{footer:(0,i.k6)((function(){return[(0,i.bF)(y,{type:"flex",justify:"space-between"},{default:(0,i.k6)((function(){return[(0,i.bF)(S,null,{default:(0,i.k6)((function(){return[(0,i.bF)(m,{onClick:(0,i.D$)(h.onSelectAllClick,["prevent"])},{default:(0,i.k6)((function(){return[(0,i.eW)("全选")]})),_:1},8,["onClick"]),(0,i.bF)(m,{onClick:n[8]||(n[8]=(0,i.D$)((function(e){return f.permissionEntity.checkedPermissionList=[]}),["prevent"]))},{default:(0,i.k6)((function(){return[(0,i.eW)("清空")]})),_:1})]})),_:1}),(0,i.bF)(S,null,{default:(0,i.k6)((function(){return[(0,i.bF)(m,{onClick:n[9]||(n[9]=(0,i.D$)((function(e){return f.permissionEntity={}}),["prevent"]))},{default:(0,i.k6)((function(){return[(0,i.eW)("取消")]})),_:1}),(0,i.bF)(m,{onClick:(0,i.D$)(h.onSubmitPermissionClick,["prevent"]),type:"primary"},{default:(0,i.k6)((function(){return[(0,i.eW)("确定")]})),_:1},8,["onClick"])]})),_:1})]})),_:1})]})),default:(0,i.k6)((function(){return[f.permissionEntity.permissionList&&f.permissionEntity.permissionList.length?((0,i.uX)(),(0,i.Wv)(F,{key:0,onCheck:h.onTreeChecked,checkStrictly:"",checkable:"",defaultExpandAll:"","tree-data":f.permissionEntity.permissionList,fieldNames:{key:"id",title:"name"},checkedKeys:f.permissionEntity.checkedPermissionList},null,8,["onCheck","tree-data","checkedKeys"])):(0,i.Q3)("",!0)]})),_:1},8,["visible","onOk"])],8,r)}var f=t(74721),h=t(41034),p=t(14048),k=t(30388),m=(t(28706),t(2008),t(51629),t(48598),t(44114),t(26099),t(58940),t(42762),t(23500),t(83496)),v=t(25818),E=t(76136),y=(t(74423),t(25276),t(54554),t(21699),function(e,n){e.includes(n)||e.push(n)}),A=function(e,n){var t=e.indexOf(n);t>-1&&e.splice(t,1)},C=function(e,n){for(var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:"id",children:"children"},i=[],r=0;r<e.length;r+=1){var a=e[r],o=a[t.id],u=a[t.children];if(u&&u.length>0){var l=C(u,n,t);l.forEach((function(e){return y(i,e)}));var c=u.filter((function(e){return n.includes(e[t.id])})).length,s=u.filter((function(e){return i.includes(e[t.id])})).length;c>0&&c<u.length||s>0?(A(n,o),i.push(o)):c==u.length&&y(n,o)}}return i},b=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{id:"id",children:"children"},i=C(e,n,t);return{checked:n,halfChecked:i}},g=function(e){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"id",children:"children"},t=[],i=0;i<e.length;i+=1){var r=e[i];y(t,r[n.id]);var a=r[n.children];a&&a.length>0&&g(a,n).forEach((function(e){return y(t,e)}))}return t},w=function(e,n,t){var i=n.halfChecked,r=void 0===i?[]:i,a=n.checked,o=void 0===a?[]:a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{id:"id",children:"children"},l=t[u.id];o.includes(l)?A(o,l):y(o,l);var c=o.includes(l),s=t[u.children]||[];return c?(A(o,l),g(s,u).forEach((function(e){return A(o,e)}))):(A(r,l),y(o,l),g(s,u).forEach((function(e){return y(o,e)}))),b(e,o,u)};const _={data:function(){var e=this;return{sortField:"",sortOrder:"",showAddRoleModal:!1,showRolePermissionModal:!1,editEntity:{},permissionEntity:{checkedPermissionList:[]},nameLike:"",levelList:[{name:"系统级",value:"system"},{name:"用户级",value:"user"}],defaultColumns:[{title:"编码",dataIndex:"id"},{title:"名称",dataIndex:"name"},{title:"备注",dataIndex:"note"},{title:"级别",customRender:function(n){n.text;var t=n.record;n.index,n.column;return(e.levelList.filter((function(e){return e.value==t.level}))[0]||{}).name||""}},{title:"添加人",dataIndex:"updName"},{title:"添加日期",dataIndex:"updTime"},{title:"操作",key:"action",width:280}],pagination:{current:1,pageSize:parseInt(v.qN.PAGE_SIZE_OPTIONS[0]),showQuickJumper:!0,showSizeChanger:!0,data:[],total:0,pageSizeOptions:v.qN.PAGE_SIZE_OPTIONS,showTotal:function(){return"共 ".concat(e.pagination.total," 条")}}}},mounted:function(){var e=this;return(0,k.A)((0,p.A)().mark((function n(){return(0,p.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.onSearchClick();case 1:case"end":return n.stop()}}),n)})))()},methods:{onTreeChecked:function(e,n){var t=n.node.dataRef,i=this.permissionEntity.permissionList,r=void 0===i?[]:i;this.permissionEntity.checkedPermissionList=w(r,e,t)},handleTableChange:function(e,n,t){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.sortField=t.field,this.sortOrder=t.order,this.requestData(!0)},onSubmitEditEntityClick:function(){var e=this;return(0,k.A)((0,p.A)().mark((function n(){var t,i;return(0,p.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t=(0,h.A)({},e.editEntity),!E.A.isEmpty(t.level)){n.next=4;break}return m.A.showToast("请选择角色级别"),n.abrupt("return");case 4:if(!E.A.isEmpty(t.id)){n.next=7;break}return m.A.showToast("请输入角色编码"),n.abrupt("return");case 7:if(t.id=(t.id+"").trim(),!E.A.isEmpty(t.name)){n.next=11;break}return m.A.showToast("请输入角色名称"),n.abrupt("return");case 11:return t.name=(t.name+"").trim(),delete t.updAccount,delete t.updName,delete t.updTime,n.next=17,m.A.postAsync(v.tl.SUPER_ROLE_SAVE,t);case 17:i=n.sent,0==i.status&&(m.A.showToast(i.message),e.showAddRoleModal=!1,e.editEntity={},e.onSearchClick());case 19:case"end":return n.stop()}}),n)})))()},onItemEditClick:function(e){this.showAddRoleModal=!0;var n=(0,h.A)({},e);this.editEntity=n},onItemDeleteClick:function(e){var n=this;this.$confirm({title:"提示",content:"确定要删除该角色吗？",onOk:function(){var t=(0,k.A)((0,p.A)().mark((function t(){var i;return(0,p.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return m.A.showLoading(),t.next=3,m.A.postAsync(v.tl.SUPER_ROLE_DEL,{roleId:e.id});case 3:i=t.sent,m.A.hideLoading(),0==i.status&&(m.A.showToast(i.message),n.onSearchClick());case 6:case"end":return t.stop()}}),t)})));function i(){return t.apply(this,arguments)}return i}()})},onSelectAllClick:function(){var e=[],n=function(t){t.forEach((function(t){e.push(t.id),t.children&&t.children.length>0&&n(t.children)}))};n(this.permissionEntity.permissionList),this.permissionEntity.checkedPermissionList={checked:e,halfChecked:[]}},onItemEditPermissionsClick:function(e){var n=this;return(0,k.A)((0,p.A)().mark((function t(){var i,r,a,o,u,l,c;return(0,p.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m.A.postAsync(v.tl.SUPER_ROLE_MENU_LIST,{roleId:e.id});case 2:i=t.sent,0==i.status&&(r=(0,h.A)({},e),a=i.data,o=a.allMenus,u=void 0===o?[]:o,l=a.roleMenus,c=void 0===l?[]:l,r.permissionList=u,r.checkedPermissionList=b(u,c),n.permissionEntity=r);case 4:case"end":return t.stop()}}),t)})))()},onSubmitPermissionClick:function(){var e=this;return(0,k.A)((0,p.A)().mark((function n(){var t,i,r,a,o,u;return(0,p.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e.permissionEntity,i=t.checkedPermissionList,r=i.checked,a=i.halfChecked,o=[].concat((0,f.A)(r),(0,f.A)(a)),m.A.showLoading(),n.next=6,m.A.postAsync(v.tl.SUPER_ROLE_MENU_SAVE,{roleId:t.id,menuIds:o.join(",")});case 6:u=n.sent,m.A.hideLoading(),0==u.status&&(m.A.showToast(u.message),e.permissionEntity={});case 9:case"end":return n.stop()}}),n)})))()},onItemClearPermissionsClick:function(e){var n=this;this.$confirm({title:"提示",content:"确定要清空该角色菜单？",onOk:function(){var t=(0,k.A)((0,p.A)().mark((function t(){var i;return(0,p.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return m.A.showLoading(),t.next=3,m.A.postAsync(v.tl.SUPER_ROLE_MENU_SAVE,{roleId:e.id});case 3:i=t.sent,m.A.hideLoading(),0==i.status&&(m.A.showToast(i.message),n.onSearchClick());case 6:case"end":return t.stop()}}),t)})));function i(){return t.apply(this,arguments)}return i}()})},onSearchClick:function(){var e=this.pagination;e.current=1,this.requestData(!0)},onResetClick:function(){this.nameLike="",this.onSearchClick()},requestData:function(){var e=arguments,n=this;return(0,k.A)((0,p.A)().mark((function t(){var i,r,a,o,u,l,c,s;return(0,p.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.length>0&&void 0!==e[0]&&e[0],r=n.nameLike,a=n.sortField,o=n.sortOrder,u=n.pagination,i&&m.A.showLoading(),l={page:u.current,limit:u.pageSize},E.A.isEmpty(r)||(l.name=r),E.A.isEmpty(a)||(l.orderField=a,l.orderType="ascend"==o?"asc":"descend"==o?"desc":""),t.next=9,m.A.postAsync(v.tl.SUPER_ROLE_LIST,l);case 9:c=t.sent,0==c.status&&(s=c.data,u.current=s.page,u.total=s.count,u.data=s.data),n.pagination=u,i&&m.A.hideLoading();case 13:case"end":return t.stop()}}),t)})))()}}};var L=t(71241);const F=(0,L.A)(_,[["render",d]]),S=F}}]);