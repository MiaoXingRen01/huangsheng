(self["webpackChunkweb_admin"]=self["webpackChunkweb_admin"]||[]).push([[948],{22130:e=>{var t=[{name1:"正常",value:1,color:"green"},{name1:"冻结",value:2,color:"red"}];function n(e,t){for(var n=0;n<e.length;n++)if(e[n].value==t)return e[n];return{}}function a(e,t,a){return n(e,t)[a]}function r(e,t){return a(e,t,"name1")}function i(e,t){return a(e,t,"name3")}function u(e,t){return a(e,t,"color")}e.exports={getName3ByValue:i,getUserStateText:function(e){return r(t,e)},getUserStateColor:function(e){return u(t,e)}}},67948:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_});n(62010);var a=n(35280),r=["id"],i=(0,a.Lk)("i",{class:"ri-add-line"},null,-1),u=(0,a.Lk)("span",null,"添加用户",-1),o=["onClick"],l=["onClick"],s=["onClick"],c=["onClick"],d=["onClick"],f=["onClick"],p=["onClick"];function h(e,t,n,h,k,v){var m=(0,a.g2)("a-input"),b=(0,a.g2)("a-form-item"),y=(0,a.g2)("a-select-option"),g=(0,a.g2)("a-select"),A=(0,a.g2)("a-button"),E=(0,a.g2)("a-form"),w=(0,a.g2)("a-space"),C=(0,a.g2)("a-row"),F=(0,a.g2)("a-tag"),_=(0,a.g2)("a-divider"),I=(0,a.g2)("a-table"),x=(0,a.g2)("a-card"),L=(0,a.g2)("a-upload"),S=(0,a.g2)("a-radio"),U=(0,a.g2)("a-radio-group"),T=(0,a.g2)("a-tree-select"),R=(0,a.g2)("a-modal"),P=(0,a.g2)("viewer");return(0,a.uX)(),(0,a.CE)("div",{id:e.$route.name},[(0,a.bF)(x,null,{title:(0,a.k6)((function(){return[(0,a.bF)(C,{justify:"space-between",align:"top"},{default:(0,a.k6)((function(){return[(0,a.bF)(E,{layout:"inline"},{default:(0,a.k6)((function(){return[(0,a.bF)(b,null,{default:(0,a.k6)((function(){return[(0,a.bF)(m,{placeholder:"账号/姓名/手机号",value:k.searchText,"onUpdate:value":t[0]||(t[0]=function(e){return k.searchText=e}),style:{width:"180px"},allowClear:""},null,8,["value"])]})),_:1}),(0,a.bF)(b,null,{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"角色",value:k.searchRoleId,"onUpdate:value":t[1]||(t[1]=function(e){return k.searchRoleId=e}),style:{width:"180px"},allowClear:""},{default:(0,a.k6)((function(){return[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.roleList,(function(e){return(0,a.uX)(),(0,a.Wv)(y,{key:e.id,value:e.id},{default:(0,a.k6)((function(){return[(0,a.eW)((0,a.v_)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1}),(0,a.bF)(b,null,{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"状态",value:k.searchStatus,"onUpdate:value":t[2]||(t[2]=function(e){return k.searchStatus=e}),style:{width:"180px"},allowClear:""},{default:(0,a.k6)((function(){return[(0,a.bF)(y,{value:"1"},{default:(0,a.k6)((function(){return[(0,a.eW)("正常")]})),_:1}),(0,a.bF)(y,{value:"2"},{default:(0,a.k6)((function(){return[(0,a.eW)("冻结")]})),_:1})]})),_:1},8,["value"])]})),_:1}),(0,a.bF)(b,null,{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"是否删除",value:k.searchDelFlag,"onUpdate:value":t[3]||(t[3]=function(e){return k.searchDelFlag=e}),style:{width:"180px"},allowClear:""},{default:(0,a.k6)((function(){return[(0,a.bF)(y,{value:"y"},{default:(0,a.k6)((function(){return[(0,a.eW)("是")]})),_:1}),(0,a.bF)(y,{value:"n"},{default:(0,a.k6)((function(){return[(0,a.eW)("否")]})),_:1})]})),_:1},8,["value"])]})),_:1}),(0,a.bF)(b,null,{default:(0,a.k6)((function(){return[(0,a.bF)(A,{type:"primary",onClick:(0,a.D$)(v.onSearchClick,["prevent"])},{default:(0,a.k6)((function(){return[(0,a.eW)("查询")]})),_:1},8,["onClick"]),(0,a.bF)(A,{type:"link",onClick:(0,a.D$)(v.onResetClick,["prevent"])},{default:(0,a.k6)((function(){return[(0,a.eW)("重置")]})),_:1},8,["onClick"])]})),_:1})]})),_:1}),(0,a.bF)(w,null,{default:(0,a.k6)((function(){return[(0,a.bF)(A,{type:"primary",onClick:t[4]||(t[4]=(0,a.D$)((function(e){return v.onItemEditClick()}),["prevent"]))},{default:(0,a.k6)((function(){return[i,u]})),_:1})]})),_:1})]})),_:1})]})),default:(0,a.k6)((function(){return[(0,a.bF)(I,{columns:k.defaultColumns,onChange:v.handleTableChange,"data-source":k.pagination.data,pagination:k.pagination,rowKey:function(e){return e.id},scroll:{x:1e3},bordered:""},{bodyCell:(0,a.k6)((function(e){var t=e.column,n=e.record;return["state"==t.key?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},["n"==n.delFlag?((0,a.uX)(),(0,a.Wv)(F,{key:0,color:k.statusUtil.getUserStateColor(n.status)},{default:(0,a.k6)((function(){return[(0,a.eW)((0,a.v_)(k.statusUtil.getUserStateText(n.status)),1)]})),_:2},1032,["color"])):((0,a.uX)(),(0,a.Wv)(F,{key:1,color:"red"},{default:(0,a.k6)((function(){return[(0,a.eW)("已删除")]})),_:1}))],64)):"action"==t.key?((0,a.uX)(),(0,a.CE)(a.FK,{key:1},[(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemShowClick(n)}),["prevent"])},"查看",8,o),(0,a.bF)(_,{type:"vertical"}),(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemEditClick(n)}),["prevent"])},"编辑",8,l),"n"==n.delFlag?((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[(0,a.bF)(_,{type:"vertical"}),(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemDeleteClick(n)}),["prevent"])},"删除",8,s)],64)):(0,a.Q3)("",!0),(0,a.bF)(_,{type:"vertical"}),1==n.status?((0,a.uX)(),(0,a.CE)("a",{key:1,href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemSatusClick(n,2)}),["prevent"])},"冻结",8,c)):(0,a.Q3)("",!0),2==n.status?((0,a.uX)(),(0,a.CE)("a",{key:2,href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemSatusClick(n,1)}),["prevent"])},"解冻",8,d)):(0,a.Q3)("",!0),(0,a.bF)(_,{type:"vertical"}),(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemResetPasswordClick(n)}),["prevent"])},"重置密码",8,f),(0,a.bF)(_,{type:"vertical"}),(0,a.Lk)("a",{href:"javascript:;",onClick:(0,a.D$)((function(e){return v.onItemForceLogoutClick(n)}),["prevent"])},"强制下线",8,p)],64)):(0,a.Q3)("",!0)]})),_:1},8,["columns","onChange","data-source","pagination","rowKey"])]})),_:1}),(0,a.bF)(R,{visible:k.showAddUserModal,"onUpdate:visible":t[13]||(t[13]=function(e){return k.showAddUserModal=e}),title:"用户信息",width:"600px",centered:"",onCancel:t[14]||(t[14]=function(e){return k.editEntity={}}),onOk:v.onSubmitEditEntityClick},{default:(0,a.k6)((function(){return[(0,a.bF)(E,{labelCol:{span:7},wrapperCol:{span:13}},{default:(0,a.k6)((function(){return[(0,a.bF)(b,{label:"登录账号",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(m,{placeholder:"请输入",value:k.editEntity.account,"onUpdate:value":t[5]||(t[5]=function(e){return k.editEntity.account=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"角色",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(g,{placeholder:"请选择",value:k.editEntity.roleId,"onUpdate:value":t[6]||(t[6]=function(e){return k.editEntity.roleId=e}),disabled:k.editEntity.readonly},{default:(0,a.k6)((function(){return[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.roleList,(function(e){return(0,a.uX)(),(0,a.Wv)(y,{key:e.id,value:e.id},{default:(0,a.k6)((function(){return[(0,a.eW)((0,a.v_)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"姓名",required:""},{default:(0,a.k6)((function(){return[(0,a.bF)(m,{placeholder:"请输入",value:k.editEntity.name,"onUpdate:value":t[7]||(t[7]=function(e){return k.editEntity.name=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"头像"},{default:(0,a.k6)((function(){return[(0,a.bF)(L,{"list-type":"picture",name:"file",multiple:!1,onPreview:v.onPreviewClick,fileList:v.convert2FileList("editEntity","header","headerPicType"),beforeUpload:function(e){return v.onFileChanged("editEntity","header",e)},onRemove:t[8]||(t[8]=function(){return k.editEntity.header=""})},{default:(0,a.k6)((function(){return[(0,a.bF)(A,{icon:"upload"},{default:(0,a.k6)((function(){return[(0,a.eW)("上传")]})),_:1})]})),_:1},8,["onPreview","fileList","beforeUpload"])]})),_:1}),(0,a.bF)(b,{label:"性别"},{default:(0,a.k6)((function(){return[(0,a.bF)(U,{name:"radioGroup",value:k.editEntity.sex,"onUpdate:value":t[9]||(t[9]=function(e){return k.editEntity.sex=e}),disabled:k.editEntity.readonly},{default:(0,a.k6)((function(){return[(0,a.bF)(S,{value:"1"},{default:(0,a.k6)((function(){return[(0,a.eW)("男")]})),_:1}),(0,a.bF)(S,{value:"0"},{default:(0,a.k6)((function(){return[(0,a.eW)("女")]})),_:1})]})),_:1},8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"手机号"},{default:(0,a.k6)((function(){return[(0,a.bF)(m,{placeholder:"请输入",value:k.editEntity.phone,"onUpdate:value":t[10]||(t[10]=function(e){return k.editEntity.phone=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"身份证号"},{default:(0,a.k6)((function(){return[(0,a.bF)(m,{placeholder:"请输入",value:k.editEntity.idcardNo,"onUpdate:value":t[11]||(t[11]=function(e){return k.editEntity.idcardNo=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,a.bF)(b,{label:"所属部门"},{default:(0,a.k6)((function(){return[(0,a.bF)(T,{placeholder:"请输入",value:k.editEntity.deptIds,"onUpdate:value":t[12]||(t[12]=function(e){return k.editEntity.deptIds=e}),"tree-data":k.departmentTreeList,fieldNames:{key:"id",label:"name",value:"id"}},null,8,["value","tree-data"])]})),_:1})]})),_:1})]})),_:1},8,["visible","onOk"]),(0,a.bF)(P,{visible:!!k.largeImagePath,onOnClose:t[15]||(t[15]=function(e){return k.largeImagePath=""}),src:k.largeImagePath},null,8,["visible","src"])],8,r)}var k=n(41034),v=n(14048),m=n(30388),b=(n(28706),n(51629),n(44114),n(26099),n(58940),n(27495),n(90906),n(47764),n(42762),n(23500),n(62953),n(3296),n(27208),n(48408),n(14603),n(47566),n(98721),n(83496)),y=n(76136),g=n(22130),A=n.n(g),E=n(25818);const w={data:function(){var e=this;return{sortField:"",sortOrder:"",editEntity:{},showAddUserModal:!1,statusUtil:A(),accountLike:"",searchText:"",searchRoleId:null,searchStatus:null,searchDelFlag:null,roleList:[],largeImagePath:"",departmentTreeList:[],permissionEntity:{checkedPermissionList:[]},defaultColumns:[{title:"账号",dataIndex:"account"},{title:"姓名",dataIndex:"name"},{title:"角色",dataIndex:"roleName"},{title:"手机号",dataIndex:"phone"},{title:"状态",key:"state"},{title:"更新时间",dataIndex:"updTime"},{title:"最后活跃时间",dataIndex:"activeTime"},{title:"所属部门",dataIndex:"deptNames"},{title:"操作",key:"action",width:360}],pagination:{current:1,pageSize:parseInt(E.qN.PAGE_SIZE_OPTIONS[0]),showQuickJumper:!0,showSizeChanger:!0,data:[],total:0,pageSizeOptions:E.qN.PAGE_SIZE_OPTIONS,showTotal:function(){return"共 ".concat(e.pagination.total," 条")}}}},mounted:function(){var e=this;return(0,m.A)((0,v.A)().mark((function t(){var n,a;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,b.A.postAsync(E.tl.SUPER_ROLE_LIST,{page:1,limit:E.qN.MAX_LIMIT});case 2:return n=t.sent,0==n.status&&(e.roleList=n.data.data),t.next=6,b.A.postAsync(E.tl.SUPER_DEPARTMENT_TREE_LIST);case 6:a=t.sent,0==a.status&&(e.departmentTreeList=a.data),e.requestData(!0);case 9:case"end":return t.stop()}}),t)})))()},methods:{onFileChanged:function(e,t,n){return this[e][t]=n,!1},convert2FileList:function(e,t,n){var a=this[e],r=a[t];if(r){if("string"==typeof r){if(y.A.isBase64(r))return a[n]="base64",[{uid:-1*Math.random(),url:r,name:" "}];a[n]="";r.split("/");return[{uid:-1*Math.random(),url:y.A.isHttp(r)?r:"".concat(E.tl.ROOT_IMAGE).concat(r),name:" "}]}return a[n]="",r.url||(r.url=window.URL?window.URL.createObjectURL(r):window.webkitURL.createObjectURL(r)),[r]}return[]},onPreviewClick:function(e){if(!y.A.isEmpty(e.url))if(/^data:image/.test(e.url)){var t=new Image;t.src=e.url;var n=window.open("","_blank");n.document.write(t.outerHTML),n.document.close()}else window.open(e.url)},onSelectAllClick:function(){var e=[],t=function(n){n.forEach((function(n){n.uniPlatformUrls&&n.uniPlatformUrls.length>0?t(n.uniPlatformUrls):e.push(n.id)}))};t(this.permissionEntity.permissionList),this.permissionEntity.checkedPermissionList=e},handleTableChange:function(e,t,n){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.sortField=n.field,this.sortOrder=n.order,this.requestData(!0)},onSubmitEditEntityClick:function(){var e=this;return(0,m.A)((0,v.A)().mark((function t(){var n,a,r,i,u;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.editEntity,console.log(n),!n.readonly){t.next=6;break}return e.showAddUserModal=!1,e.editEntity={},t.abrupt("return");case 6:if(a={},y.A.isEmpty(n.userId)||(a.id=n.userId),y.A.isEmpty(n.sex)||(a.sex=n.sex),y.A.isEmpty(n.phone)||(a.phone=n.phone),y.A.isEmpty(n.idcardNo)||(a.idcardNo=n.idcardNo),y.A.isEmpty(n.deptIds)||(a.deptIds=n.deptIds),!y.A.isEmpty(n.account)){t.next=15;break}return b.A.showToast("请输入登录账号"),t.abrupt("return");case 15:if(a.account=(n.account+"").trim(),!y.A.isEmpty(n.name)){t.next=19;break}return b.A.showToast("请输入姓名"),t.abrupt("return");case 19:if(a.name=(n.name+"").trim(),!y.A.isEmpty(n.roleId)){t.next=23;break}return b.A.showToast("请选择角色"),t.abrupt("return");case 23:if(a.roleId=n.roleId,!(n.header instanceof File)){t.next=40;break}return t.next=27,y.A.compressFile(n.header);case 27:return r=t.sent,t.next=30,b.A.uploadAsync(E.tl.FILE_UPLOAD,null!=r?r:n.header);case 30:if(i=t.sent,0!=i.status){t.next=35;break}a.header=i.data.newName,t.next=38;break;case 35:return b.A.showToast("上传头像出错"),b.A.hideLoading(),t.abrupt("return");case 38:t.next=41;break;case 40:a.header=n.header||"";case 41:return t.next=43,b.A.postAsync(E.tl.SUPER_USER_SAVE,a);case 43:u=t.sent,0==u.status&&(b.A.showToast(u.message),e.showAddUserModal=!1,e.editEntity={},e.onSearchClick());case 45:case"end":return t.stop()}}),t)})))()},onItemShowClick:function(e){this.showAddUserModal=!0,this.editEntity=(0,k.A)((0,k.A)({},e),{},{readonly:!0})},onItemEditClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,k.A)({},e);this.editEntity=t,this.showAddUserModal=!0},onItemDeleteClick:function(e){var t=this;this.$confirm({title:"提示",content:"确定要删除该用户吗？",onOk:function(){var n=(0,m.A)((0,v.A)().mark((function n(){var a;return(0,v.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return b.A.showLoading(),n.next=3,b.A.postAsync(E.tl.SUPER_USER_DEL,{userId:e.userId});case 3:a=n.sent,b.A.hideLoading(),0==a.status&&(b.A.showToast(a.message),t.onSearchClick());case 6:case"end":return n.stop()}}),n)})));function a(){return n.apply(this,arguments)}return a}()})},onItemForceLogoutClick:function(e){this.$confirm({title:"提示",content:"确定要下线该用户吗？",onOk:function(){var t=(0,m.A)((0,v.A)().mark((function t(){var n;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return b.A.showLoading(),t.next=3,b.A.postAsync(E.tl.FORCE_USER_LOGOUT,{userId:e.userId});case 3:n=t.sent,b.A.hideLoading(),0==n.status&&b.A.showToast(n.message);case 6:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()})},onItemSatusClick:function(e,t){var n=this,a={userId:e.userId},r=1==t?"确认解冻该用户？":"确认冻结该用户？";a.operate=1==t?"enable":"disable",this.$confirm({title:"提示",content:r,onOk:function(){var e=(0,m.A)((0,v.A)().mark((function e(){var t;return(0,v.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return b.A.showLoading(),e.next=3,b.A.postAsync(E.tl.SUPER_USER_ENABLE,a);case 3:t=e.sent,b.A.hideLoading(),b.A.showToast(t.message),0==t.status&&n.onSearchClick();case 7:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()})},onItemResetPasswordClick:function(e){this.$confirm({title:"提示",content:"确定要重置该用户密码为默认密码？",onOk:function(){var t=(0,m.A)((0,v.A)().mark((function t(){var n;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return b.A.showLoading(),t.next=3,b.A.postAsync(E.tl.SUPER_USER_RESETPWD,{userId:e.userId});case 3:n=t.sent,b.A.hideLoading(),0==n.status&&b.A.showToast(n.message);case 6:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()})},onSearchClick:function(){var e=this.pagination;e.current=1,this.requestData(!0)},onResetClick:function(){this.searchText=this.searchRoleId=null,this.searchStatus=this.searchDelFlag=null,this.onSearchClick()},requestData:function(){var e=arguments,t=this;return(0,m.A)((0,v.A)().mark((function n(){var a,r,i,u,o,l,s,c,d,f,p;return(0,v.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]&&e[0],r=t.searchText,i=t.searchRoleId,u=t.sortField,o=t.sortOrder,l=t.searchStatus,s=t.searchDelFlag,c=t.pagination,a&&b.A.showLoading(),d={page:c.current,limit:c.pageSize},y.A.isEmpty(r)||(d.user=r),y.A.isEmpty(i)||(d.roleId=i),y.A.isEmpty(l)||(d.status=l),y.A.isEmpty(u)||(d.orderField=u,d.orderType="ascend"==o?"asc":"descend"==o?"desc":""),d.delFlag=s,n.next=12,b.A.postAsync(E.tl.SUPER_USER_LIST,d);case 12:f=n.sent,a&&b.A.hideLoading(),0==f.status&&(p=f.data,c.current=p.page,c.total=p.count,c.data=p.data),t.pagination=c;case 16:case"end":return n.stop()}}),n)})))()}}};var C=n(71241);const F=(0,C.A)(w,[["render",h]]),_=F}}]);