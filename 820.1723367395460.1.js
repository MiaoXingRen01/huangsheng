(self["webpackChunkweb_admin"]=self["webpackChunkweb_admin"]||[]).push([[820],{22130:e=>{var t=[{name1:"正常",value:1,color:"green"},{name1:"冻结",value:2,color:"red"}];function n(e,t){for(var n=0;n<e.length;n++)if(e[n].value==t)return e[n];return{}}function r(e,t,r){return n(e,t)[r]}function a(e,t){return r(e,t,"name1")}function i(e,t){return r(e,t,"name3")}function u(e,t){return r(e,t,"color")}e.exports={getName3ByValue:i,getUserStateText:function(e){return a(t,e)},getUserStateColor:function(e){return u(t,e)}}},98820:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});n(62010);var r=n(35280),a=["id"],i=(0,r.Lk)("i",{class:"ri-add-line"},null,-1),u=(0,r.Lk)("span",null,"添加用户",-1),o=["onClick"],l=["onClick"],s=["onClick"],c=["onClick"],d=["onClick"],f=["onClick"],p=["onClick"];function h(e,t,n,h,k,v){var b=(0,r.g2)("a-input"),m=(0,r.g2)("a-form-item"),y=(0,r.g2)("a-select-option"),A=(0,r.g2)("a-select"),g=(0,r.g2)("a-button"),E=(0,r.g2)("a-form"),w=(0,r.g2)("a-space"),F=(0,r.g2)("a-row"),I=(0,r.g2)("a-tag"),C=(0,r.g2)("a-divider"),_=(0,r.g2)("a-table"),L=(0,r.g2)("a-card"),x=(0,r.g2)("a-upload"),S=(0,r.g2)("a-radio"),U=(0,r.g2)("a-radio-group"),T=(0,r.g2)("a-tree-select"),D=(0,r.g2)("a-modal"),R=(0,r.g2)("viewer");return(0,r.uX)(),(0,r.CE)("div",{id:e.$route.name},[(0,r.bF)(L,null,{title:(0,r.k6)((function(){return[(0,r.bF)(F,{justify:"space-between",align:"top",class:"pt-4"},{default:(0,r.k6)((function(){return[(0,r.bF)(E,{layout:"inline"},{default:(0,r.k6)((function(){return[(0,r.bF)(m,null,{default:(0,r.k6)((function(){return[(0,r.bF)(b,{placeholder:"账号/姓名/手机号",value:k.searchText,"onUpdate:value":t[0]||(t[0]=function(e){return k.searchText=e})},null,8,["value"])]})),_:1}),(0,r.bF)(m,{label:"角色"},{default:(0,r.k6)((function(){return[(0,r.bF)(A,{placeholder:"请选择",value:k.searchRoleId,"onUpdate:value":t[1]||(t[1]=function(e){return k.searchRoleId=e})},{default:(0,r.k6)((function(){return[(0,r.bF)(y,{value:""},{default:(0,r.k6)((function(){return[(0,r.eW)("全部")]})),_:1}),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.roleList,(function(e){return(0,r.uX)(),(0,r.Wv)(y,{key:e.id,value:e.id},{default:(0,r.k6)((function(){return[(0,r.eW)((0,r.v_)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value"])]})),_:1}),(0,r.bF)(m,{label:"状态"},{default:(0,r.k6)((function(){return[(0,r.bF)(A,{placeholder:"请选择",value:k.searchStatus,"onUpdate:value":t[2]||(t[2]=function(e){return k.searchStatus=e})},{default:(0,r.k6)((function(){return[(0,r.bF)(y,{value:""},{default:(0,r.k6)((function(){return[(0,r.eW)("全部")]})),_:1}),(0,r.bF)(y,{value:"1"},{default:(0,r.k6)((function(){return[(0,r.eW)("正常")]})),_:1}),(0,r.bF)(y,{value:"2"},{default:(0,r.k6)((function(){return[(0,r.eW)("冻结")]})),_:1})]})),_:1},8,["value"])]})),_:1}),(0,r.bF)(m,{label:"是否删除"},{default:(0,r.k6)((function(){return[(0,r.bF)(A,{placeholder:"请选择",value:k.searchDelFlag,"onUpdate:value":t[3]||(t[3]=function(e){return k.searchDelFlag=e})},{default:(0,r.k6)((function(){return[(0,r.bF)(y,{value:""},{default:(0,r.k6)((function(){return[(0,r.eW)("全部")]})),_:1}),(0,r.bF)(y,{value:"y"},{default:(0,r.k6)((function(){return[(0,r.eW)("是")]})),_:1}),(0,r.bF)(y,{value:"n"},{default:(0,r.k6)((function(){return[(0,r.eW)("否")]})),_:1})]})),_:1},8,["value"])]})),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)((function(){return[(0,r.bF)(g,{type:"primary",onClick:(0,r.D$)(v.onSearchClick,["prevent"])},{default:(0,r.k6)((function(){return[(0,r.eW)("查询")]})),_:1},8,["onClick"]),(0,r.bF)(g,{type:"link",onClick:(0,r.D$)(v.onResetClick,["prevent"])},{default:(0,r.k6)((function(){return[(0,r.eW)("重置")]})),_:1},8,["onClick"])]})),_:1})]})),_:1}),(0,r.bF)(w,null,{default:(0,r.k6)((function(){return[(0,r.bF)(g,{type:"primary",onClick:t[4]||(t[4]=(0,r.D$)((function(e){return v.onItemEditClick()}),["prevent"]))},{default:(0,r.k6)((function(){return[i,u]})),_:1})]})),_:1})]})),_:1})]})),default:(0,r.k6)((function(){return[(0,r.bF)(_,{columns:k.defaultColumns,onChange:v.handleTableChange,"data-source":k.pagination.data,pagination:k.pagination,rowKey:function(e){return e.id},scroll:{x:1e3},bordered:""},{bodyCell:(0,r.k6)((function(e){var t=e.column,n=e.record;return["state"==t.key?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},["n"==n.delFlag?((0,r.uX)(),(0,r.Wv)(I,{key:0,color:k.statusUtil.getUserStateColor(n.status)},{default:(0,r.k6)((function(){return[(0,r.eW)((0,r.v_)(k.statusUtil.getUserStateText(n.status)),1)]})),_:2},1032,["color"])):((0,r.uX)(),(0,r.Wv)(I,{key:1,color:"red"},{default:(0,r.k6)((function(){return[(0,r.eW)("已删除")]})),_:1}))],64)):"action"==t.key?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.Lk)("a",{href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemShowClick(n)}),["prevent"])},"查看",8,o),(0,r.bF)(C,{type:"vertical"}),(0,r.Lk)("a",{href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemEditClick(n)}),["prevent"])},"编辑",8,l),"n"==n.delFlag?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(C,{type:"vertical"}),(0,r.Lk)("a",{href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemDeleteClick(n)}),["prevent"])},"删除",8,s)],64)):(0,r.Q3)("",!0),(0,r.bF)(C,{type:"vertical"}),1==n.status?((0,r.uX)(),(0,r.CE)("a",{key:1,href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemSatusClick(n,2)}),["prevent"])},"冻结",8,c)):(0,r.Q3)("",!0),2==n.status?((0,r.uX)(),(0,r.CE)("a",{key:2,href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemSatusClick(n,1)}),["prevent"])},"解冻",8,d)):(0,r.Q3)("",!0),(0,r.bF)(C,{type:"vertical"}),(0,r.Lk)("a",{href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemResetPasswordClick(n)}),["prevent"])},"重置密码",8,f),(0,r.bF)(C,{type:"vertical"}),(0,r.Lk)("a",{href:"javascript:;",onClick:(0,r.D$)((function(e){return v.onItemForceLogoutClick(n)}),["prevent"])},"强制下线",8,p)],64)):(0,r.Q3)("",!0)]})),_:1},8,["columns","onChange","data-source","pagination","rowKey"])]})),_:1}),(0,r.bF)(D,{visible:k.showAddUserModal,"onUpdate:visible":t[13]||(t[13]=function(e){return k.showAddUserModal=e}),title:"用户信息",width:"600px",centered:"",onCancel:t[14]||(t[14]=function(e){return k.editEntity={}}),onOk:v.onSubmitEditEntityClick},{default:(0,r.k6)((function(){return[(0,r.bF)(E,{labelCol:{span:7},wrapperCol:{span:13}},{default:(0,r.k6)((function(){return[(0,r.bF)(m,{label:"登录账号",required:""},{default:(0,r.k6)((function(){return[(0,r.bF)(b,{placeholder:"请输入",value:k.editEntity.account,"onUpdate:value":t[5]||(t[5]=function(e){return k.editEntity.account=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"角色",required:""},{default:(0,r.k6)((function(){return[(0,r.bF)(A,{placeholder:"请选择",value:k.editEntity.roleId,"onUpdate:value":t[6]||(t[6]=function(e){return k.editEntity.roleId=e}),disabled:k.editEntity.readonly},{default:(0,r.k6)((function(){return[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.roleList,(function(e){return(0,r.uX)(),(0,r.Wv)(y,{key:e.id,value:e.id},{default:(0,r.k6)((function(){return[(0,r.eW)((0,r.v_)(e.name),1)]})),_:2},1032,["value"])})),128))]})),_:1},8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"姓名",required:""},{default:(0,r.k6)((function(){return[(0,r.bF)(b,{placeholder:"请输入",value:k.editEntity.name,"onUpdate:value":t[7]||(t[7]=function(e){return k.editEntity.name=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"头像"},{default:(0,r.k6)((function(){return[(0,r.bF)(x,{"list-type":"picture",name:"file",multiple:!1,onPreview:v.onPreviewClick,fileList:v.convert2FileList("editEntity","header","headerPicType"),beforeUpload:function(e){return v.onFileChanged("editEntity","header",e)},onRemove:t[8]||(t[8]=function(){return k.editEntity.header=""})},{default:(0,r.k6)((function(){return[(0,r.bF)(g,{icon:"upload"},{default:(0,r.k6)((function(){return[(0,r.eW)("上传")]})),_:1})]})),_:1},8,["onPreview","fileList","beforeUpload"])]})),_:1}),(0,r.bF)(m,{label:"性别"},{default:(0,r.k6)((function(){return[(0,r.bF)(U,{name:"radioGroup",value:k.editEntity.sex,"onUpdate:value":t[9]||(t[9]=function(e){return k.editEntity.sex=e}),disabled:k.editEntity.readonly},{default:(0,r.k6)((function(){return[(0,r.bF)(S,{value:"1"},{default:(0,r.k6)((function(){return[(0,r.eW)("男")]})),_:1}),(0,r.bF)(S,{value:"0"},{default:(0,r.k6)((function(){return[(0,r.eW)("女")]})),_:1})]})),_:1},8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"手机号"},{default:(0,r.k6)((function(){return[(0,r.bF)(b,{placeholder:"请输入",value:k.editEntity.phone,"onUpdate:value":t[10]||(t[10]=function(e){return k.editEntity.phone=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"身份证号"},{default:(0,r.k6)((function(){return[(0,r.bF)(b,{placeholder:"请输入",value:k.editEntity.idcardNo,"onUpdate:value":t[11]||(t[11]=function(e){return k.editEntity.idcardNo=e}),disabled:k.editEntity.readonly},null,8,["value","disabled"])]})),_:1}),(0,r.bF)(m,{label:"所属部门",required:""},{default:(0,r.k6)((function(){return[(0,r.bF)(T,{placeholder:"请输入",value:k.editEntity.deptIds,"onUpdate:value":t[12]||(t[12]=function(e){return k.editEntity.deptIds=e}),"tree-data":k.departmentTreeList,fieldNames:{key:"id",label:"name",value:"id"}},null,8,["value","tree-data"])]})),_:1})]})),_:1})]})),_:1},8,["visible","onOk"]),(0,r.bF)(R,{visible:!!k.largeImagePath,onOnClose:t[15]||(t[15]=function(e){return k.largeImagePath=""}),src:k.largeImagePath},null,8,["visible","src"])],8,a)}var k=n(41034),v=n(14048),b=n(30388),m=(n(28706),n(2008),n(51629),n(44114),n(26099),n(58940),n(27495),n(90906),n(47764),n(42762),n(23500),n(62953),n(3296),n(27208),n(48408),n(14603),n(47566),n(98721),n(83496)),y=n(76136),A=n(22130),g=n.n(A),E=n(25818);const w={data:function(){var e=this;return{sortField:"",sortOrder:"",editEntity:{},showAddUserModal:!1,statusUtil:g(),accountLike:"",searchText:"",searchRoleId:"",searchStatus:"",searchDelFlag:"n",roleList:[],largeImagePath:"",departmentTreeList:[],permissionEntity:{checkedPermissionList:[]},defaultColumns:[{title:"账号",dataIndex:"account"},{title:"姓名",dataIndex:"name"},{title:"角色",dataIndex:"roleName"},{title:"手机号",dataIndex:"phone"},{title:"状态",key:"state"},{title:"更新时间",dataIndex:"updTime"},{title:"最后活跃时间",dataIndex:"activeTime"},{title:"所属部门",dataIndex:"deptNames"},{title:"操作",key:"action",width:360}],pagination:{current:1,pageSize:parseInt(E.qN.PAGE_SIZE_OPTIONS[0]),showQuickJumper:!0,showSizeChanger:!0,data:[],total:0,pageSizeOptions:E.qN.PAGE_SIZE_OPTIONS,showTotal:function(){return"共 ".concat(e.pagination.total," 条")}}}},mounted:function(){var e=this;return(0,b.A)((0,v.A)().mark((function t(){var n,r;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m.A.postAsync(E.tl.SUPER_ROLE_LIST,{page:1,limit:E.qN.MAX_LIMIT});case 2:return n=t.sent,0==n.status&&(e.roleList=n.data.data.filter((function(e){return"user"==e.level}))),t.next=6,m.A.postAsync(E.tl.USER_DEPARTMENT_TREE_LIST,{userId:m.A.userInfo.get().userId});case 6:r=t.sent,0==r.status&&(e.departmentTreeList=r.data),e.requestData(!0);case 9:case"end":return t.stop()}}),t)})))()},methods:{onFileChanged:function(e,t,n){return this[e][t]=n,!1},convert2FileList:function(e,t,n){var r=this[e],a=r[t];if(a){if("string"==typeof a){if(y.A.isBase64(a))return r[n]="base64",[{uid:-1*Math.random(),url:a,name:" "}];r[n]="";a.split("/");return[{uid:-1*Math.random(),url:y.A.isHttp(a)?a:"".concat(E.tl.ROOT_IMAGE).concat(a),name:" "}]}return r[n]="",a.url||(a.url=window.URL?window.URL.createObjectURL(a):window.webkitURL.createObjectURL(a)),[a]}return[]},onPreviewClick:function(e){if(!y.A.isEmpty(e.url))if(/^data:image/.test(e.url)){var t=new Image;t.src=e.url;var n=window.open("","_blank");n.document.write(t.outerHTML),n.document.close()}else window.open(e.url)},onSelectAllClick:function(){var e=[],t=function(n){n.forEach((function(n){n.uniPlatformUrls&&n.uniPlatformUrls.length>0?t(n.uniPlatformUrls):e.push(n.id)}))};t(this.permissionEntity.permissionList),this.permissionEntity.checkedPermissionList=e},handleTableChange:function(e,t,n){this.pagination.current=e.current,this.pagination.pageSize=e.pageSize,this.sortField=n.field,this.sortOrder=n.order,this.requestData(!0)},onSubmitEditEntityClick:function(){var e=this;return(0,b.A)((0,v.A)().mark((function t(){var n,r,a,i,u;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.editEntity,console.log(n),!n.readonly){t.next=6;break}return e.showAddUserModal=!1,e.editEntity={},t.abrupt("return");case 6:if(r={},y.A.isEmpty(n.userId)||(r.id=n.userId),y.A.isEmpty(n.sex)||(r.sex=n.sex),y.A.isEmpty(n.phone)||(r.phone=n.phone),y.A.isEmpty(n.idcardNo)||(r.idcardNo=n.idcardNo),!y.A.isEmpty(n.account)){t.next=14;break}return m.A.showToast("请输入登录账号"),t.abrupt("return");case 14:if(r.account=(n.account+"").trim(),!y.A.isEmpty(n.name)){t.next=18;break}return m.A.showToast("请输入姓名"),t.abrupt("return");case 18:if(r.name=(n.name+"").trim(),!y.A.isEmpty(n.roleId)){t.next=22;break}return m.A.showToast("请选择角色"),t.abrupt("return");case 22:if(r.roleId=n.roleId,!y.A.isEmpty(n.deptIds)){t.next=26;break}return m.A.showToast("请选择部门"),t.abrupt("return");case 26:if(r.deptIds=n.deptIds,!(n.header instanceof File)){t.next=43;break}return t.next=30,y.A.compressFile(n.header);case 30:return a=t.sent,t.next=33,m.A.uploadAsync(E.tl.FILE_UPLOAD,null!=a?a:n.header);case 33:if(i=t.sent,0!=i.status){t.next=38;break}r.header=i.data.newName,t.next=41;break;case 38:return m.A.showToast("上传头像出错"),m.A.hideLoading(),t.abrupt("return");case 41:t.next=44;break;case 43:r.header=n.header||"";case 44:return t.next=46,m.A.postAsync(E.tl.ADMIN_USER_SAVE,r);case 46:u=t.sent,0==u.status&&(m.A.showToast(u.message),e.showAddUserModal=!1,e.editEntity={},e.onSearchClick());case 48:case"end":return t.stop()}}),t)})))()},onItemShowClick:function(e){this.showAddUserModal=!0,this.editEntity=(0,k.A)((0,k.A)({},e),{},{readonly:!0})},onItemEditClick:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,k.A)({},e);this.editEntity=t,this.showAddUserModal=!0},onItemDeleteClick:function(e){var t=this;this.$confirm({title:"提示",content:"确定要删除该用户吗？",onOk:function(){var n=(0,b.A)((0,v.A)().mark((function n(){var r;return(0,v.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return m.A.showLoading(),n.next=3,m.A.postAsync(E.tl.ADMIN_USER_DEL,{userId:e.userId});case 3:r=n.sent,m.A.hideLoading(),0==r.status&&(m.A.showToast(r.message),t.onSearchClick());case 6:case"end":return n.stop()}}),n)})));function r(){return n.apply(this,arguments)}return r}()})},onItemForceLogoutClick:function(e){this.$confirm({title:"提示",content:"确定要下线该用户吗？",onOk:function(){var t=(0,b.A)((0,v.A)().mark((function t(){var n;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return m.A.showLoading(),t.next=3,m.A.postAsync(E.tl.FORCE_USER_LOGOUT,{userId:e.userId});case 3:n=t.sent,m.A.hideLoading(),0==n.status&&m.A.showToast(n.message);case 6:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()})},onItemSatusClick:function(e,t){var n=this,r={userId:e.userId},a=1==t?"确认解冻该用户？":"确认冻结该用户？";r.operate=1==t?"enable":"disable",this.$confirm({title:"提示",content:a,onOk:function(){var e=(0,b.A)((0,v.A)().mark((function e(){var t;return(0,v.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return m.A.showLoading(),e.next=3,m.A.postAsync(E.tl.ADMIN_USER_ENABLE,r);case 3:t=e.sent,m.A.hideLoading(),m.A.showToast(t.message),0==t.status&&n.onSearchClick();case 7:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()})},onItemResetPasswordClick:function(e){this.$confirm({title:"提示",content:"确定要重置该用户密码为默认密码？",onOk:function(){var t=(0,b.A)((0,v.A)().mark((function t(){var n;return(0,v.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return m.A.showLoading(),t.next=3,m.A.postAsync(E.tl.ADMIN_USER_RESETPWD,{userId:e.userId});case 3:n=t.sent,m.A.hideLoading(),0==n.status&&m.A.showToast(n.message);case 6:case"end":return t.stop()}}),t)})));function n(){return t.apply(this,arguments)}return n}()})},onSearchClick:function(){var e=this.pagination;e.current=1,this.requestData(!0)},onResetClick:function(){this.searchText=this.searchRoleId="",this.searchStatus=this.searchDelFlag="",this.onSearchClick()},requestData:function(){var e=arguments,t=this;return(0,b.A)((0,v.A)().mark((function n(){var r,a,i,u,o,l,s,c,d,f,p;return(0,v.A)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.length>0&&void 0!==e[0]&&e[0],a=t.searchText,i=t.searchRoleId,u=t.sortField,o=t.sortOrder,l=t.searchStatus,s=t.searchDelFlag,c=t.pagination,r&&m.A.showLoading(),d={page:c.current,limit:c.pageSize},y.A.isEmpty(a)||(d.user=a),y.A.isEmpty(i)||(d.roleId=i),y.A.isEmpty(l)||(d.status=l),y.A.isEmpty(u)||(d.orderField=u,d.orderType="ascend"==o?"asc":"descend"==o?"desc":""),d.delFlag=s,n.next=12,m.A.postAsync(E.tl.ADMIN_USER_LIST,d);case 12:f=n.sent,r&&m.A.hideLoading(),0==f.status&&(p=f.data,c.current=p.page,c.total=p.count,c.data=p.data),t.pagination=c;case 16:case"end":return n.stop()}}),n)})))()}}};var F=n(71241);const I=(0,F.A)(w,[["render",h]]),C=I}}]);